<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å³æ—¶é€šè®¯</title>
    <link rel="stylesheet" href="styles/common.css">
    <link rel="stylesheet" href="styles/chat.css">
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <header class="header">
            <div class="header-content">
                <button class="back-btn" onclick="history.back()">
                    <span class="back-arrow">â€¹</span>
                </button>
                <div class="chat-info">
                    <h1 id="chatTitle">åä¸œåŒº5Gä¸“ç½‘äº¤æµç¾¤</h1>
                    <span class="online-count" id="onlineCount">10äººåœ¨çº¿</span>
                </div>
                <button class="more-btn" onclick="simpleShowMenu()">
                    <span class="more-icon">â‹¯</span>
                </button>
            </div>
        </header>

        <!-- èŠå¤©æ¶ˆæ¯åŒºåŸŸ -->
        <div class="chat-messages" id="chatMessages">
            <!-- æ¶ˆæ¯å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- æ¶ˆæ¯è¾“å…¥åŒºåŸŸ -->
        <div class="message-input-area">
            <div class="input-toolbar">
                <button class="tool-btn" onclick="selectFile()">
                    <img src="images/file-icon.png" alt="æ–‡ä»¶">
                </button>
                <button class="tool-btn" onclick="selectImage()">
                    <img src="images/image-icon.png" alt="å›¾ç‰‡">
                </button>
                <button class="tool-btn" onclick="showEmoji()">
                    <img src="images/emoji-icon.png" alt="è¡¨æƒ…">
                </button>
                <button class="tool-btn" onclick="showAIAssist()">
                    <img src="images/ai-icon.png" alt="AIåŠ©æ‰‹">
                </button>
            </div>
            <div class="input-container">
                <textarea class="message-input" placeholder="è¾“å…¥æ¶ˆæ¯..." id="messageInput"></textarea>
                <button class="send-btn" onclick="sendMessage()">
                    <img src="images/send-icon.png" alt="å‘é€">
                </button>
            </div>
        </div>

        <!-- AIåŠ©æ‰‹é¢æ¿ -->
        <div class="ai-assist-panel" id="aiAssistPanel" style="display: none;">
            <div class="ai-panel-header">
                <h3>AIæ™ºèƒ½åŠ©æ‰‹</h3>
                <button class="close-btn" onclick="hideAIAssist()">Ã—</button>
            </div>
            <div class="ai-suggestions">
                <div class="suggestion-item" onclick="insertSuggestion('è¯·é—®5Gä¸“ç½‘çš„è¦†ç›–èŒƒå›´å¦‚ä½•è§„åˆ’ï¼Ÿ')">
                    <span class="suggestion-text">è¯·é—®5Gä¸“ç½‘çš„è¦†ç›–èŒƒå›´å¦‚ä½•è§„åˆ’ï¼Ÿ</span>
                </div>
                <div class="suggestion-item" onclick="insertSuggestion('æœ‰æ²¡æœ‰è¾¹ç¼˜è®¡ç®—éƒ¨ç½²çš„æœ€ä½³å®è·µï¼Ÿ')">
                    <span class="suggestion-text">æœ‰æ²¡æœ‰è¾¹ç¼˜è®¡ç®—éƒ¨ç½²çš„æœ€ä½³å®è·µï¼Ÿ</span>
                </div>
                <div class="suggestion-item" onclick="insertSuggestion('äº‘å¹³å°çš„å®‰å…¨ç­–ç•¥åº”è¯¥å¦‚ä½•é…ç½®ï¼Ÿ')">
                    <span class="suggestion-text">äº‘å¹³å°çš„å®‰å…¨ç­–ç•¥åº”è¯¥å¦‚ä½•é…ç½®ï¼Ÿ</span>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <nav class="bottom-nav">
        <div class="nav-item" onclick="navigateTo('index.html')">
            <img src="images/home-icon.png" alt="é¦–é¡µ">
            <span>é¦–é¡µ</span>
        </div>
        <div class="nav-item" onclick="navigateTo('resource-library.html')">
            <img src="images/resource-nav-icon.png" alt="èµ„æºåº“">
            <span>èµ„æºåº“</span>
        </div>
        <div class="nav-item" onclick="navigateTo('work-circle.html')">
            <img src="images/circle-nav-icon.png" alt="å·¥ä½œåœˆ">
            <span>å·¥ä½œåœˆ</span>
        </div>
        <div class="nav-item" onclick="navigateTo('profile.html')">
            <img src="images/profile-icon.png" alt="æˆ‘çš„">
            <span>æˆ‘çš„</span>
        </div>
    </nav>


    <script src="scripts/common.js"></script>
    <script src="scripts/chat.js"></script>
    <script>
        // ç®€å•çš„èœå•å‡½æ•°ï¼Œç›´æ¥åˆ›å»ºå’Œæ˜¾ç¤º
        function simpleShowMenu() {
            console.log('simpleShowMenu è¢«è°ƒç”¨');

            // ç§»é™¤å·²å­˜åœ¨çš„æ¨¡æ€æ¡†
            const existingModal = document.getElementById('simpleMenuModal');
            if (existingModal) {
                existingModal.remove();
            }

            // è·å–å½“å‰èŠå¤©ä¿¡æ¯
            const chatInfo = window.currentChatInfo || {
                name: 'åä¸œåŒº5Gä¸“ç½‘äº¤æµç¾¤',
                type: 'group',
                onlineCount: 156
            };

            // åˆ›å»ºæ–°çš„æ¨¡æ€æ¡†
            const modal = document.createElement('div');
            modal.id = 'simpleMenuModal';
            modal.style.cssText = `
                display: flex;
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                justify-content: center;
                align-items: center;
            `;

            // æ ¹æ®èŠå¤©ç±»å‹ç”Ÿæˆä¸åŒçš„èœå•å†…å®¹
            let menuContent = '';
            if (chatInfo.type === 'group') {
                // ç¾¤èŠèœå•
                menuContent = generateGroupMenu(chatInfo);
            } else {
                // ç§èŠèœå•
                menuContent = generateContactMenu(chatInfo);
            }

            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 12px;
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
                    max-width: 360px;
                    width: 90%;
                    max-height: 80vh;
                    overflow-y: auto;
                ">
                    <div style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 16px 20px;
                        border-bottom: 1px solid #f0f0f0;
                    ">
                        <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: #333;">èŠå¤©èœå•</h3>
                        <button onclick="simpleCloseMenu()" style="
                            background: none;
                            border: none;
                            font-size: 24px;
                            color: #999;
                            cursor: pointer;
                            padding: 0;
                            width: 32px;
                            height: 32px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            border-radius: 50%;
                        ">&times;</button>
                    </div>
                    <div id="simpleMenuBody" style="padding: 20px;">
                        ${menuContent}
                    </div>
                </div>
            `;

            // æ·»åŠ ç‚¹å‡»èƒŒæ™¯å…³é—­åŠŸèƒ½
            modal.onclick = function(e) {
                if (e.target === modal) {
                    console.log('ç‚¹å‡»èƒŒæ™¯å…³é—­');
                    simpleCloseMenu();
                }
            };

            document.body.appendChild(modal);
            console.log('æ¨¡æ€æ¡†å·²åˆ›å»ºå¹¶æ˜¾ç¤º');
        }

        // ç”Ÿæˆç¾¤èŠèœå•å†…å®¹
        function generateGroupMenu(chatInfo) {
            const totalMembers = 16; // ç¾¤æˆå‘˜æ€»æ•°
            const onlineMembers = 10; // åœ¨çº¿äººæ•°

            return `
                <div style="
                    display: flex;
                    align-items: center;
                    gap: 12px;
                    padding: 16px 0;
                    border-bottom: 1px solid #f0f0f0;
                    margin-bottom: 16px;
                ">
                    <div style="
                        width: 60px;
                        height: 60px;
                        border-radius: 50%;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 24px;
                        color: white;
                    ">ğŸ‘¥</div>
                    <div>
                        <h4 style="margin: 0 0 4px 0; font-size: 16px; font-weight: 600; color: #333;">${chatInfo.name}</h4>
                        <p style="margin: 0; font-size: 14px; color: #666;">ç¾¤æˆå‘˜ ${totalMembers}äºº Â· ${onlineMembers}äººåœ¨çº¿</p>
                    </div>
                </div>
                <div id="simpleMenuList" style="display: flex; flex-direction: column; gap: 4px;">
                    <div onclick="simpleMenuAction('ç¾¤æˆå‘˜åˆ—è¡¨')" style="
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        padding: 12px 8px;
                        cursor: pointer;
                        border-radius: 8px;
                        transition: all 0.2s;
                    " onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                        <span style="font-size: 18px; width: 24px; text-align: center;">ğŸ‘¥</span>
                        <span>ç¾¤æˆå‘˜åˆ—è¡¨</span>
                        <span style="margin-left: auto; background: #667eea; color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; margin-right: 8px;">${totalMembers}</span>
                        <span style="color: #999; font-size: 16px;">â€º</span>
                    </div>
                    <div onclick="simpleMenuAction('ç¾¤èŠä¿¡æ¯')" style="
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        padding: 12px 8px;
                        cursor: pointer;
                        border-radius: 8px;
                        transition: all 0.2s;
                    " onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                        <span style="font-size: 18px; width: 24px; text-align: center;">â„¹ï¸</span>
                        <span>ç¾¤èŠä¿¡æ¯</span>
                        <span style="margin-left: auto; color: #999; font-size: 16px;">â€º</span>
                    </div>
                    <div onclick="simpleMenuAction('ç¾¤æ–‡ä»¶')" style="
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        padding: 12px 8px;
                        cursor: pointer;
                        border-radius: 8px;
                        transition: all 0.2s;
                    " onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                        <span style="font-size: 18px; width: 24px; text-align: center;">ğŸ“</span>
                        <span>ç¾¤æ–‡ä»¶</span>
                        <span style="margin-left: auto; color: #999; font-size: 16px;">â€º</span>
                    </div>
                    <div style="height: 1px; background: #f0f0f0; margin: 8px 0;"></div>
                    <div onclick="simpleMenuAction('èŠå¤©è®°å½•æœç´¢')" style="
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        padding: 12px 8px;
                        cursor: pointer;
                        border-radius: 8px;
                        transition: all 0.2s;
                    " onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                        <span style="font-size: 18px; width: 24px; text-align: center;">ğŸ”</span>
                        <span>èŠå¤©è®°å½•æœç´¢</span>
                        <span style="margin-left: auto; color: #999; font-size: 16px;">â€º</span>
                    </div>
                    <div onclick="simpleMenuAction('æ¸…ç©ºèŠå¤©è®°å½•')" style="
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        padding: 12px 8px;
                        cursor: pointer;
                        border-radius: 8px;
                        transition: all 0.2s;
                    " onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                        <span style="font-size: 18px; width: 24px; text-align: center;">ğŸ—‘ï¸</span>
                        <span>æ¸…ç©ºèŠå¤©è®°å½•</span>
                        <span style="margin-left: auto; color: #999; font-size: 16px;">â€º</span>
                    </div>
                </div>
            `;
        }

        // ç”Ÿæˆç§èŠèœå•å†…å®¹
        function generateContactMenu(chatInfo) {
            return `
                <div style="
                    display: flex;
                    align-items: center;
                    gap: 12px;
                    padding: 16px 0;
                    border-bottom: 1px solid #f0f0f0;
                    margin-bottom: 16px;
                ">
                    <div style="
                        width: 60px;
                        height: 60px;
                        border-radius: 50%;
                        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 24px;
                        color: white;
                    ">ğŸ‘¨â€ğŸ’¼</div>
                    <div>
                        <h4 style="margin: 0 0 4px 0; font-size: 16px; font-weight: 600; color: #333;">${chatInfo.name}</h4>
                        <p style="margin: 0; font-size: 14px; color: #666;">
                            <span style="display: inline-block; width: 8px; height: 8px; background: #28a745; border-radius: 50%; margin-right: 6px;"></span>
                            åœ¨çº¿
                        </p>
                    </div>
                </div>
                <div id="simpleMenuList" style="display: flex; flex-direction: column; gap: 4px;">
                    <div onclick="simpleMenuAction('è”ç³»äººä¿¡æ¯')" style="
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        padding: 12px 8px;
                        cursor: pointer;
                        border-radius: 8px;
                        transition: all 0.2s;
                    " onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                        <span style="font-size: 18px; width: 24px; text-align: center;">ğŸ‘¤</span>
                        <span>è”ç³»äººä¿¡æ¯</span>
                        <span style="margin-left: auto; color: #999; font-size: 16px;">â€º</span>
                    </div>
                    <div onclick="simpleMenuAction('å…±äº«æ–‡ä»¶')" style="
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        padding: 12px 8px;
                        cursor: pointer;
                        border-radius: 8px;
                        transition: all 0.2s;
                    " onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                        <span style="font-size: 18px; width: 24px; text-align: center;">ğŸ“</span>
                        <span>å…±äº«æ–‡ä»¶</span>
                        <span style="margin-left: auto; color: #999; font-size: 16px;">â€º</span>
                    </div>
                    <div onclick="simpleMenuAction('è§†é¢‘é€šè¯')" style="
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        padding: 12px 8px;
                        cursor: pointer;
                        border-radius: 8px;
                        transition: all 0.2s;
                    " onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                        <span style="font-size: 18px; width: 24px; text-align: center;">ğŸ“¹</span>
                        <span>è§†é¢‘é€šè¯</span>
                        <span style="margin-left: auto; color: #999; font-size: 16px;">â€º</span>
                    </div>
                    <div onclick="simpleMenuAction('è¯­éŸ³é€šè¯')" style="
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        padding: 12px 8px;
                        cursor: pointer;
                        border-radius: 8px;
                        transition: all 0.2s;
                    " onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                        <span style="font-size: 18px; width: 24px; text-align: center;">ğŸ“</span>
                        <span>è¯­éŸ³é€šè¯</span>
                        <span style="margin-left: auto; color: #999; font-size: 16px;">â€º</span>
                    </div>
                    <div style="height: 1px; background: #f0f0f0; margin: 8px 0;"></div>
                    <div onclick="simpleMenuAction('èŠå¤©è®°å½•æœç´¢')" style="
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        padding: 12px 8px;
                        cursor: pointer;
                        border-radius: 8px;
                        transition: all 0.2s;
                    " onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                        <span style="font-size: 18px; width: 24px; text-align: center;">ğŸ”</span>
                        <span>èŠå¤©è®°å½•æœç´¢</span>
                        <span style="margin-left: auto; color: #999; font-size: 16px;">â€º</span>
                    </div>
                    <div onclick="simpleMenuAction('æ¸…ç©ºèŠå¤©è®°å½•')" style="
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        padding: 12px 8px;
                        cursor: pointer;
                        border-radius: 8px;
                        transition: all 0.2s;
                    " onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                        <span style="font-size: 18px; width: 24px; text-align: center;">ğŸ—‘ï¸</span>
                        <span>æ¸…ç©ºèŠå¤©è®°å½•</span>
                        <span style="margin-left: auto; color: #999; font-size: 16px;">â€º</span>
                    </div>
                </div>
            `;
        }

        function simpleCloseMenu() {
            console.log('simpleCloseMenu è¢«è°ƒç”¨');
            const modal = document.getElementById('simpleMenuModal');
            if (modal) {
                modal.remove();
                console.log('æ¨¡æ€æ¡†å·²ç§»é™¤');
            }
        }

        function simpleMenuAction(action) {
            console.log('èœå•åŠ¨ä½œ:', action);
            const body = document.getElementById('simpleMenuBody');
            if (!body) return;

            // è¾…åŠ©ï¼šè¿”å›æŒ‰é’®
            const backBtn = `<button onclick="simpleShowMenu()" style="border:none;background:none;color:#667eea;font-weight:600;cursor:pointer;padding:0;">\u2190 è¿”å›</button>`;

            if (action === 'ç¾¤æˆå‘˜åˆ—è¡¨') {
                body.innerHTML = `
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                        ${backBtn}
                        <h4 style="margin:0;">ç¾¤æˆå‘˜åˆ—è¡¨</h4>
                        <span style="width:64px;"></span>
                    </div>
                    <div style="margin-bottom:12px;padding:8px 12px;background:#f8f9fa;border-radius:6px;font-size:14px;color:#666;">
                        å…±16äººï¼Œ10äººåœ¨çº¿
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;">
                        ${[
                            {name:'å¼ å·¥ç¨‹å¸ˆ', role:'ç¾¤ä¸»', avatar:'ğŸ‘¨â€ğŸ’¼', online: true},
                            {name:'ææŠ€æœ¯', role:'ç®¡ç†å‘˜', avatar:'ğŸ‘©â€ğŸ’»', online: true},
                            {name:'ç‹è¿ç»´', role:'æˆå‘˜', avatar:'ğŸ‘¨â€ğŸ”§', online: true},
                            {name:'èµµäº§å“', role:'æˆå‘˜', avatar:'ğŸ‘©â€ğŸ’¼', online: false},
                            {name:'é™ˆä¸“å®¶', role:'æˆå‘˜', avatar:'ğŸ‘¨â€ğŸ“', online: true},
                            {name:'åˆ˜ç»ç†', role:'æˆå‘˜', avatar:'ğŸ‘©â€ğŸ’¼', online: false}
                        ].map(u => `
                            <div style="display:flex;gap:12px;align-items:center;padding:10px;border:1px solid #eee;border-radius:8px;position:relative;">
                                <div style="width:40px;height:40px;border-radius:50%;background:#f3f4ff;display:flex;align-items:center;justify-content:center;font-size:18px;position:relative;">${u.avatar}
                                    ${u.online ? '<div style="position:absolute;bottom:-2px;right:-2px;width:12px;height:12px;background:#28a745;border:2px solid white;border-radius:50%;"></div>' : ''}
                                </div>
                                <div style="display:flex;flex-direction:column;">
                                    <span style="font-weight:600;color:#333;">${u.name}</span>
                                    <span style="font-size:12px;color:#999;">${u.role}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (action === 'ç¾¤èŠä¿¡æ¯') {
                const chatInfo = window.currentChatInfo || {name: 'åä¸œåŒº5Gä¸“ç½‘äº¤æµç¾¤'};
                body.innerHTML = `
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                        ${backBtn}
                        <h4 style="margin:0;">ç¾¤èŠä¿¡æ¯</h4>
                        <span style="width:64px;"></span>
                    </div>
                    <div style="display:flex;flex-direction:column;gap:10px;">
                        <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f0f0f0;"><span>ç¾¤åç§°</span><span style="color:#333;font-weight:600;">${chatInfo.name}</span></div>
                        <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f0f0f0;"><span>æˆå‘˜æ•°é‡</span><span style="color:#333;font-weight:600;">16äºº</span></div>
                        <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f0f0f0;"><span>åœ¨çº¿äººæ•°</span><span style="color:#333;font-weight:600;">10äºº</span></div>
                        <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f0f0f0;"><span>åˆ›å»ºæ—¶é—´</span><span style="color:#333;font-weight:600;">2024-01-15</span></div>
                        <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f0f0f0;"><span>ç¾¤ä¸»</span><span style="color:#333;font-weight:600;">å¼ å·¥ç¨‹å¸ˆ</span></div>
                        <div style="padding:10px 0;">
                            <div style="color:#666;font-size:12px;margin-bottom:6px;">ç¾¤æè¿°</div>
                            <div style="color:#333;">ä¸“ä¸šæŠ€æœ¯äº¤æµä¸æ”¯æŒï¼Œåˆ†äº«èµ„æ–™ã€ç­”ç–‘è§£æƒ‘ã€ç»éªŒæ²‰æ·€ã€‚</div>
                        </div>
                    </div>
                `;
            } else if (action === 'ç¾¤æ–‡ä»¶') {
                body.innerHTML = `
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                        ${backBtn}
                        <h4 style="margin:0;">ç¾¤æ–‡ä»¶</h4>
                        <span style="width:64px;"></span>
                    </div>
                    <div style="display:flex;flex-direction:column;gap:8px;">
                        ${[
                            {icon:'ğŸ“„', name:'5Gä¸“ç½‘ä¼˜åŒ–å‚æ•°é…ç½®.pdf', size:'2.1MB'},
                            {icon:'ğŸ“Š', name:'è¡Œä¸šå®¢æˆ·æ¡ˆä¾‹ç²¾é€‰.pptx', size:'8.4MB'},
                            {icon:'ğŸ–¼ï¸', name:'ç½‘ç»œæ‹“æ‰‘å›¾.png', size:'1.2MB'}
                        ].map(f => `
                            <div style="display:flex;align-items:center;gap:10px;padding:10px;border:1px solid #eee;border-radius:8px;">
                                <div style="font-size:20px;width:24px;text-align:center;">${f.icon}</div>
                                <div style="flex:1;display:flex;flex-direction:column;">
                                    <span style="color:#333;font-weight:600;">${f.name}</span>
                                    <span style="color:#999;font-size:12px;">${f.size}</span>
                                </div>
                                <button style="border:none;background:#667eea;color:#fff;border-radius:6px;padding:6px 10px;cursor:pointer;">ä¸‹è½½</button>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (action === 'èŠå¤©è®°å½•æœç´¢') {
                body.innerHTML = `
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                        ${backBtn}
                        <h4 style="margin:0;">èŠå¤©è®°å½•æœç´¢</h4>
                        <span style="width:64px;"></span>
                    </div>
                    <div style="display:flex;gap:8px;margin-bottom:12px;">
                        <input id="simpleSearchInput" type="text" placeholder="è¾“å…¥å…³é”®è¯..." style="flex:1;padding:8px 10px;border:1px solid #ddd;border-radius:6px;"/>
                        <button onclick="simpleSearchChat()" style="border:none;background:#667eea;color:#fff;border-radius:6px;padding:8px 12px;cursor:pointer;">æœç´¢</button>
                    </div>
                    <div id="simpleSearchResults" style="color:#666;">è¯·è¾“å…¥å…³é”®è¯è¿›è¡Œæœç´¢</div>
                `;
                // å®šä¹‰å…¨å±€æœç´¢å‡½æ•°
                window.simpleSearchChat = function() {
                    const kw = (document.getElementById('simpleSearchInput')?.value || '').trim();
                    const box = document.getElementById('simpleSearchResults');
                    if (!box) return;
                    if (!kw) { box.innerHTML = 'è¯·è¾“å…¥å…³é”®è¯è¿›è¡Œæœç´¢'; return; }
                    box.innerHTML = `æ‰¾åˆ° <b>3</b> æ¡åŒ…å« â€œ${kw}â€ çš„è®°å½•ï¼ˆç¤ºä¾‹ï¼‰`;
                }
            } else if (action === 'æ¸…ç©ºèŠå¤©è®°å½•') {
                body.innerHTML = `
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                        ${backBtn}
                        <h4 style="margin:0;">æ¸…ç©ºèŠå¤©è®°å½•</h4>
                        <span style="width:64px;"></span>
                    </div>
                    <div style="padding:10px;border:1px solid #ffeaa7;background:#fff8e1;color:#856404;border-radius:8px;margin-bottom:12px;">
                        æ­¤æ“ä½œå°†ä»å½“å‰é¡µé¢æ¸…ç©ºå¯è§èŠå¤©è®°å½•ã€‚
                    </div>
                    <div style="display:flex;gap:8px;">
                        <button onclick="simpleShowMenu()" style="border:1px solid #ddd;background:#fff;border-radius:6px;padding:8px 12px;cursor:pointer;">å–æ¶ˆ</button>
                        <button onclick="simpleConfirmClearChat()" style="border:none;background:#e03131;color:#fff;border-radius:6px;padding:8px 12px;cursor:pointer;">ç¡®è®¤æ¸…ç©º</button>
                    </div>
                `;
                // å®šä¹‰å…¨å±€æ¸…ç©ºå‡½æ•°
                window.simpleConfirmClearChat = function() {
                    console.log('ğŸš€ simpleConfirmClearChatè¢«è°ƒç”¨');

                    // å…³é—­èœå•æ¨¡æ€æ¡†
                    const modal = document.getElementById('simpleMenuModal');
                    if (modal) {
                        modal.remove();
                    }

                    // è°ƒç”¨çœŸæ­£çš„æ¸…ç©ºèŠå¤©è®°å½•å‡½æ•°
                    if (typeof clearChatHistory === 'function') {
                        console.log('âœ… è°ƒç”¨clearChatHistoryå‡½æ•°');
                        // ç›´æ¥è°ƒç”¨æ¸…ç©ºé€»è¾‘ï¼Œè·³è¿‡ç¡®è®¤å¯¹è¯æ¡†ï¼ˆå› ä¸ºå·²ç»åœ¨èœå•ä¸­ç¡®è®¤è¿‡äº†ï¼‰
                        try {
                            // è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºå½“å‰çŠ¶æ€
                            console.log('ğŸ” æ¸…ç©ºèŠå¤©è®°å½• - è°ƒè¯•ä¿¡æ¯:');
                            console.log('  currentChatId:', currentChatId);
                            console.log('  currentChatInfo:', currentChatInfo);
                            console.log('  messageHistoryé•¿åº¦:', messageHistory.length);

                            // æ£€æŸ¥localStorageä¸­çš„æ‰€æœ‰èŠå¤©ç›¸å…³é”®
                            const allChatKeys = [];
                            for (let i = 0; i < localStorage.length; i++) {
                                const key = localStorage.key(i);
                                if (key && key.startsWith('chatHistory_')) {
                                    allChatKeys.push(key);
                                }
                            }
                            console.log('  localStorageä¸­çš„èŠå¤©å†å²é”®:', allChatKeys);

                            // 1. æ¸…ç©ºå†…å­˜ä¸­çš„æ¶ˆæ¯å†å²
                            messageHistory = [];
                            console.log('âœ… å·²æ¸…ç©ºå†…å­˜ä¸­çš„æ¶ˆæ¯å†å²');

                            // 2. æ¸…ç©ºlocalStorageä¸­çš„èŠå¤©å†å²
                            const storageKey = `chatHistory_${currentChatId}`;
                            console.log('  å‡†å¤‡åˆ é™¤çš„å­˜å‚¨é”®:', storageKey);

                            // æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
                            const existingData = localStorage.getItem(storageKey);
                            if (existingData) {
                                console.log('  æ‰¾åˆ°ç°æœ‰æ•°æ®ï¼Œé•¿åº¦:', existingData.length);
                                localStorage.removeItem(storageKey);

                                // éªŒè¯åˆ é™¤
                                const afterDelete = localStorage.getItem(storageKey);
                                if (afterDelete === null) {
                                    console.log('âœ… å·²æˆåŠŸæ¸…ç©ºlocalStorageä¸­çš„èŠå¤©å†å²:', storageKey);
                                } else {
                                    console.log('âŒ åˆ é™¤å¤±è´¥ï¼Œæ•°æ®ä»ç„¶å­˜åœ¨');
                                }
                            } else {
                                console.log('âš ï¸ æœªæ‰¾åˆ°å¯¹åº”çš„å­˜å‚¨æ•°æ®:', storageKey);

                                // å¦‚æœé¢„æœŸçš„é”®ä¸å­˜åœ¨ï¼Œå°è¯•æ¸…ç©ºæ‰€æœ‰èŠå¤©å†å²é”®
                                if (allChatKeys.length > 0) {
                                    console.log('  å°è¯•æ¸…ç©ºæ‰€æœ‰èŠå¤©å†å²é”®...');
                                    allChatKeys.forEach(key => {
                                        localStorage.removeItem(key);
                                        console.log('  å·²åˆ é™¤:', key);
                                    });
                                }
                            }

                            // 3. æ¸…ç©ºæµå¼ä¼ è¾“çŠ¶æ€
                            if (typeof currentStreamingState !== 'undefined' && currentStreamingState.isStreaming) {
                                // å¦‚æœæ­£åœ¨æµå¼ä¼ è¾“ï¼Œå…ˆä¸­æ–­
                                if (currentStreamingState.abortController) {
                                    currentStreamingState.abortController.abort();
                                }

                                // é‡ç½®æµå¼ä¼ è¾“çŠ¶æ€
                                currentStreamingState.isStreaming = false;
                                currentStreamingState.messageId = null;
                                currentStreamingState.userMessage = '';
                                currentStreamingState.botId = null;
                                currentStreamingState.abortController = null;
                                console.log('å·²æ¸…ç©ºæµå¼ä¼ è¾“çŠ¶æ€');
                            }

                            // 4. æ›´æ–°èŠå¤©åˆ—è¡¨ä¸­çš„æœ€æ–°æ¶ˆæ¯ï¼ˆæ¸…ç©ºæ˜¾ç¤ºï¼‰
                            if (typeof updateChatListAfterClear === 'function') {
                                updateChatListAfterClear();
                            }

                            // 5. æ¸…ç©ºæ¶ˆæ¯å®¹å™¨UI
                            const messagesContainer = document.querySelector('.chat-messages');
                            if (messagesContainer) {
                                messagesContainer.innerHTML = '<div class="empty-chat">èŠå¤©è®°å½•å·²æ¸…ç©º</div>';
                            }

                            // 6. æ¸…ç©ºåä¿æŒé¡µé¢ç©ºç™½ï¼Œä¸è‡ªåŠ¨åˆ›å»ºAIæ¬¢è¿æ¶ˆæ¯
                            console.log('âœ… æ¸…ç©ºå®Œæˆï¼Œä¿æŒé¡µé¢ç©ºç™½çŠ¶æ€');

                            console.log('âœ… èŠå¤©è®°å½•æ¸…ç©ºå®Œæˆ');

                        } catch (error) {
                            console.error('âŒ æ¸…ç©ºèŠå¤©è®°å½•æ—¶å‘ç”Ÿé”™è¯¯:', error);
                        }
                    } else {
                        console.log('âŒ clearChatHistoryå‡½æ•°ä¸å­˜åœ¨ï¼Œä½¿ç”¨ç®€åŒ–æ¸…ç©º');
                        // å¤‡ç”¨æ–¹æ¡ˆï¼šåªæ¸…ç©ºDOM
                        const msgs = document.getElementById('chatMessages');
                        if (msgs) {
                            msgs.innerHTML = '<div class="message-item system-message"><div class="message-content"><span class="system-text">èŠå¤©è®°å½•å·²æ¸…ç©º</span></div></div>';
                        }
                    }
                }
            } else if (action === 'è”ç³»äººä¿¡æ¯') {
                const chatInfo = window.currentChatInfo || {name: 'ä¸“å®¶å’¨è¯¢'};
                body.innerHTML = `
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                        ${backBtn}
                        <h4 style="margin:0;">è”ç³»äººä¿¡æ¯</h4>
                        <span style="width:64px;"></span>
                    </div>
                    <div style="text-align:center;margin-bottom:20px;">
                        <div style="width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg, #28a745 0%, #20c997 100%);display:flex;align-items:center;justify-content:center;font-size:32px;color:white;margin:0 auto 12px;">ğŸ‘¨â€ğŸ’¼</div>
                        <h3 style="margin:0 0 4px 0;color:#333;">${chatInfo.name}</h3>
                        <p style="margin:0;color:#666;font-size:14px;">
                            <span style="display:inline-block;width:8px;height:8px;background:#28a745;border-radius:50%;margin-right:6px;"></span>
                            åœ¨çº¿
                        </p>
                    </div>
                    <div style="display:flex;flex-direction:column;gap:10px;">
                        <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f0f0f0;"><span>å§“å</span><span style="color:#333;font-weight:600;">${chatInfo.name}</span></div>
                        <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f0f0f0;"><span>èŒä½</span><span style="color:#333;font-weight:600;">æŠ€æœ¯ä¸“å®¶</span></div>
                        <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f0f0f0;"><span>éƒ¨é—¨</span><span style="color:#333;font-weight:600;">æŠ€æœ¯æ”¯æŒéƒ¨</span></div>
                        <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f0f0f0;"><span>ä¸“ä¸šé¢†åŸŸ</span><span style="color:#333;font-weight:600;">5Gç½‘ç»œã€äº‘è®¡ç®—</span></div>
                        <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f0f0f0;"><span>æœåŠ¡è¯„åˆ†</span><span style="color:#333;font-weight:600;">â­â­â­â­â­ 4.9</span></div>
                    </div>
                `;
            } else if (action === 'å…±äº«æ–‡ä»¶') {
                body.innerHTML = `
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                        ${backBtn}
                        <h4 style="margin:0;">å…±äº«æ–‡ä»¶</h4>
                        <span style="width:64px;"></span>
                    </div>
                    <div style="display:flex;flex-direction:column;gap:8px;">
                        ${[
                            {icon:'ğŸ“„', name:'æŠ€æœ¯æ–¹æ¡ˆè®¨è®º.pdf', size:'1.8MB', time:'2å°æ—¶å‰'},
                            {icon:'ğŸ“Š', name:'é¡¹ç›®è¿›åº¦æŠ¥å‘Š.xlsx', size:'2.3MB', time:'æ˜¨å¤©'},
                            {icon:'ğŸ–¼ï¸', name:'ç³»ç»Ÿæ¶æ„å›¾.png', size:'856KB', time:'3å¤©å‰'}
                        ].map(f => `
                            <div style="display:flex;align-items:center;gap:10px;padding:10px;border:1px solid #eee;border-radius:8px;">
                                <div style="font-size:20px;width:24px;text-align:center;">${f.icon}</div>
                                <div style="flex:1;display:flex;flex-direction:column;">
                                    <span style="color:#333;font-weight:600;">${f.name}</span>
                                    <span style="color:#999;font-size:12px;">${f.size} Â· ${f.time}</span>
                                </div>
                                <button style="border:none;background:#28a745;color:#fff;border-radius:6px;padding:6px 10px;cursor:pointer;">ä¸‹è½½</button>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (action === 'è§†é¢‘é€šè¯') {
                body.innerHTML = `
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                        ${backBtn}
                        <h4 style="margin:0;">è§†é¢‘é€šè¯</h4>
                        <span style="width:64px;"></span>
                    </div>
                    <div style="text-align:center;padding:20px;">
                        <div style="font-size:48px;margin-bottom:16px;">ğŸ“¹</div>
                        <p style="color:#666;margin-bottom:20px;">å³å°†å‘èµ·è§†é¢‘é€šè¯</p>
                        <div style="display:flex;gap:12px;justify-content:center;">
                            <button onclick="simpleShowMenu()" style="border:1px solid #ddd;background:#fff;border-radius:6px;padding:10px 20px;cursor:pointer;">å–æ¶ˆ</button>
                            <button onclick="alert('è§†é¢‘é€šè¯åŠŸèƒ½å¼€å‘ä¸­...')" style="border:none;background:#28a745;color:#fff;border-radius:6px;padding:10px 20px;cursor:pointer;">å¼€å§‹é€šè¯</button>
                        </div>
                    </div>
                `;
            } else if (action === 'è¯­éŸ³é€šè¯') {
                body.innerHTML = `
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                        ${backBtn}
                        <h4 style="margin:0;">è¯­éŸ³é€šè¯</h4>
                        <span style="width:64px;"></span>
                    </div>
                    <div style="text-align:center;padding:20px;">
                        <div style="font-size:48px;margin-bottom:16px;">ğŸ“</div>
                        <p style="color:#666;margin-bottom:20px;">å³å°†å‘èµ·è¯­éŸ³é€šè¯</p>
                        <div style="display:flex;gap:12px;justify-content:center;">
                            <button onclick="simpleShowMenu()" style="border:1px solid #ddd;background:#fff;border-radius:6px;padding:10px 20px;cursor:pointer;">å–æ¶ˆ</button>
                            <button onclick="alert('è¯­éŸ³é€šè¯åŠŸèƒ½å¼€å‘ä¸­...')" style="border:none;background:#28a745;color:#fff;border-radius:6px;padding:10px 20px;cursor:pointer;">å¼€å§‹é€šè¯</button>
                        </div>
                    </div>
                `;
            }
        }


    </script>
</body>
</html>
