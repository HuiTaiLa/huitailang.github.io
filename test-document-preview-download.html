<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æ¡£é¢„è§ˆå’Œä¸‹è½½åŠŸèƒ½æµ‹è¯•</title>
    <link rel="stylesheet" href="styles/common.css">
    <link rel="stylesheet" href="styles/resource-library.css">
    <style>
        .test-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            background: #e9ecef;
        }
    </style>
</head>
<body>
    <!-- æµ‹è¯•æ¨ªå¹… -->
    <div class="test-banner">
        <h1>ğŸ“„ æ–‡æ¡£é¢„è§ˆå’Œä¸‹è½½åŠŸèƒ½æµ‹è¯•</h1>
        <p>æµ‹è¯•uploadsæ–‡ä»¶å¤¹ä¸­çœŸå®æ–‡æ¡£çš„é¢„è§ˆå’Œä¸‹è½½åŠŸèƒ½</p>
    </div>

    <div class="container">
        <!-- æµ‹è¯•é¢„è§ˆåŠŸèƒ½ -->
        <div class="test-section">
            <h3>ğŸ” é¢„è§ˆåŠŸèƒ½æµ‹è¯•</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•ä¸åŒæ–‡æ¡£çš„é¢„è§ˆåŠŸèƒ½ï¼š</p>
            
            <button class="test-button" onclick="testPreview('äº‘ç”µè„‘æ•™è‚²åœºæ™¯è§£å†³æ–¹æ¡ˆ.pptx')">
                é¢„è§ˆï¼šäº‘ç”µè„‘æ•™è‚²åœºæ™¯è§£å†³æ–¹æ¡ˆ
            </button>
            
            <button class="test-button" onclick="testPreview('æ™ºç®—ä¸€ä½“æœºå†…éƒ¨åŸ¹è®­ææ–™.pptx')">
                é¢„è§ˆï¼šæ™ºç®—ä¸€ä½“æœºå†…éƒ¨åŸ¹è®­ææ–™
            </button>
            
            <button class="test-button" onclick="testPreview('å…šæ”¿è¡Œä¸šé‡ç‚¹è§£å†³æ–¹æ¡ˆåŠæ¡ˆä¾‹.pptx')">
                é¢„è§ˆï¼šå…šæ”¿è¡Œä¸šé‡ç‚¹è§£å†³æ–¹æ¡ˆåŠæ¡ˆä¾‹
            </button>
            
            <button class="test-button" onclick="testPreview('æ³•åº“å¿å…¬å®‰å±€èæ™ºç®—é¡¹ç›®æ ‡æ†æ¡ˆä¾‹.docx')">
                é¢„è§ˆï¼šæ³•åº“å¿å…¬å®‰å±€èæ™ºç®—é¡¹ç›®æ ‡æ†æ¡ˆä¾‹
            </button>
            
            <div class="test-result" id="previewResult">
                é¢„è§ˆç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...
            </div>
        </div>

        <!-- æµ‹è¯•ä¸‹è½½åŠŸèƒ½ -->
        <div class="test-section">
            <h3>â¬‡ï¸ ä¸‹è½½åŠŸèƒ½æµ‹è¯•</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•æ–‡æ¡£ä¸‹è½½åŠŸèƒ½ï¼š</p>
            
            <button class="test-button" onclick="testDownload('äº‘ç”µè„‘æ•™è‚²åœºæ™¯è§£å†³æ–¹æ¡ˆ.pptx')">
                ä¸‹è½½ï¼šäº‘ç”µè„‘æ•™è‚²åœºæ™¯è§£å†³æ–¹æ¡ˆ
            </button>
            
            <button class="test-button" onclick="testDownload('æ™ºç®—ä¸€ä½“æœºå†…éƒ¨åŸ¹è®­ææ–™.pptx')">
                ä¸‹è½½ï¼šæ™ºç®—ä¸€ä½“æœºå†…éƒ¨åŸ¹è®­ææ–™
            </button>
            
            <button class="test-button" onclick="testDownload('å…šæ”¿è¡Œä¸šé‡ç‚¹è§£å†³æ–¹æ¡ˆåŠæ¡ˆä¾‹.pptx')">
                ä¸‹è½½ï¼šå…šæ”¿è¡Œä¸šé‡ç‚¹è§£å†³æ–¹æ¡ˆåŠæ¡ˆä¾‹
            </button>
            
            <button class="test-button" onclick="testDownload('æ³•åº“å¿å…¬å®‰å±€èæ™ºç®—é¡¹ç›®æ ‡æ†æ¡ˆä¾‹.docx')">
                ä¸‹è½½ï¼šæ³•åº“å¿å…¬å®‰å±€èæ™ºç®—é¡¹ç›®æ ‡æ†æ¡ˆä¾‹
            </button>
            
            <div class="test-result" id="downloadResult">
                ä¸‹è½½ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...
            </div>
        </div>

        <!-- æµ‹è¯•æ–‡æ¡£æŸ¥çœ‹å™¨é¡µé¢ -->
        <div class="test-section">
            <h3>ğŸ“– æ–‡æ¡£æŸ¥çœ‹å™¨æµ‹è¯•</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„é“¾æ¥æµ‹è¯•æ–‡æ¡£æŸ¥çœ‹å™¨é¡µé¢ï¼š</p>
            
            <a href="document-viewer.html?file=äº‘ç”µè„‘æ•™è‚²åœºæ™¯è§£å†³æ–¹æ¡ˆ.pptx" target="_blank" class="test-button" style="text-decoration: none; display: inline-block;">
                æŸ¥çœ‹ï¼šäº‘ç”µè„‘æ•™è‚²åœºæ™¯è§£å†³æ–¹æ¡ˆ
            </a>
            
            <a href="document-viewer.html?file=æ™ºç®—ä¸€ä½“æœºå†…éƒ¨åŸ¹è®­ææ–™.pptx" target="_blank" class="test-button" style="text-decoration: none; display: inline-block;">
                æŸ¥çœ‹ï¼šæ™ºç®—ä¸€ä½“æœºå†…éƒ¨åŸ¹è®­ææ–™
            </a>
            
            <a href="document-viewer.html?file=å…šæ”¿è¡Œä¸šé‡ç‚¹è§£å†³æ–¹æ¡ˆåŠæ¡ˆä¾‹.pptx" target="_blank" class="test-button" style="text-decoration: none; display: inline-block;">
                æŸ¥çœ‹ï¼šå…šæ”¿è¡Œä¸šé‡ç‚¹è§£å†³æ–¹æ¡ˆåŠæ¡ˆä¾‹
            </a>
            
            <a href="document-viewer.html?file=æ³•åº“å¿å…¬å®‰å±€èæ™ºç®—é¡¹ç›®æ ‡æ†æ¡ˆä¾‹.docx" target="_blank" class="test-button" style="text-decoration: none; display: inline-block;">
                æŸ¥çœ‹ï¼šæ³•åº“å¿å…¬å®‰å±€èæ™ºç®—é¡¹ç›®æ ‡æ†æ¡ˆä¾‹
            </a>
        </div>

        <!-- åŠŸèƒ½çŠ¶æ€æ£€æŸ¥ -->
        <div class="test-section">
            <h3>ğŸ”§ åŠŸèƒ½çŠ¶æ€æ£€æŸ¥</h3>
            <div id="statusCheck">
                <p>æ­£åœ¨æ£€æŸ¥åŠŸèƒ½çŠ¶æ€...</p>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„è„šæœ¬ -->
    <script src="scripts/common.js"></script>
    <script src="scripts/document-content-extractor.js"></script>
    <script src="scripts/resource-library.js"></script>

    <script>
        // æµ‹è¯•é¢„è§ˆåŠŸèƒ½
        function testPreview(filename) {
            const resultDiv = document.getElementById('previewResult');
            resultDiv.innerHTML = `<p>æ­£åœ¨æµ‹è¯•é¢„è§ˆåŠŸèƒ½ï¼š${filename}</p>`;
            
            try {
                // æ¨¡æ‹Ÿé¢„è§ˆåŠŸèƒ½è°ƒç”¨
                if (window.DocumentContentExtractor) {
                    const content = window.DocumentContentExtractor.extractDocumentContent(filename);
                    if (content.success) {
                        resultDiv.innerHTML = `
                            <p><strong>âœ… é¢„è§ˆåŠŸèƒ½æ­£å¸¸</strong></p>
                            <p>æ–‡æ¡£ï¼š${filename}</p>
                            <p>æ ‡é¢˜ï¼š${content.title}</p>
                            <p>æå–æ—¶é—´ï¼š${content.extractedAt}</p>
                            <details>
                                <summary>æŸ¥çœ‹å†…å®¹é¢„è§ˆ</summary>
                                <div style="max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
                                    ${content.htmlContent.substring(0, 500)}...
                                </div>
                            </details>
                        `;
                    } else {
                        resultDiv.innerHTML = `
                            <p><strong>âš ï¸ é¢„è§ˆåŠŸèƒ½éƒ¨åˆ†æ­£å¸¸</strong></p>
                            <p>æ–‡æ¡£ï¼š${filename}</p>
                            <p>çŠ¶æ€ï¼šä½¿ç”¨é»˜è®¤å†…å®¹</p>
                        `;
                    }
                } else {
                    resultDiv.innerHTML = `
                        <p><strong>âŒ é¢„è§ˆåŠŸèƒ½å¼‚å¸¸</strong></p>
                        <p>é”™è¯¯ï¼šDocumentContentExtractor æœªåŠ è½½</p>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <p><strong>âŒ é¢„è§ˆåŠŸèƒ½å¼‚å¸¸</strong></p>
                    <p>é”™è¯¯ï¼š${error.message}</p>
                `;
            }
        }

        // æµ‹è¯•ä¸‹è½½åŠŸèƒ½
        function testDownload(filename) {
            const resultDiv = document.getElementById('downloadResult');
            resultDiv.innerHTML = `<p>æ­£åœ¨æµ‹è¯•ä¸‹è½½åŠŸèƒ½ï¼š${filename}</p>`;

            try {
                // ç”±äºæœ¬åœ°æ–‡ä»¶è®¿é—®çš„CORSé™åˆ¶ï¼Œç›´æ¥æµ‹è¯•ä¸‹è½½åŠŸèƒ½
                resultDiv.innerHTML = `
                    <p><strong>âœ… ä¸‹è½½åŠŸèƒ½å‡†å¤‡å°±ç»ª</strong></p>
                    <p>æ–‡ä»¶ï¼š${filename}</p>
                    <p>çŠ¶æ€ï¼šç”±äºCORSé™åˆ¶ï¼Œæ— æ³•æ£€æŸ¥æ–‡ä»¶å­˜åœ¨æ€§ï¼Œä½†å¯ä»¥å°è¯•ä¸‹è½½</p>
                    <button class="test-button" onclick="actualDownload('${filename}')">å®é™…ä¸‹è½½</button>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <p><strong>âŒ ä¸‹è½½åŠŸèƒ½å¼‚å¸¸</strong></p>
                    <p>é”™è¯¯ï¼š${error.message}</p>
                `;
            }
        }

        // å®é™…ä¸‹è½½æ–‡ä»¶
        function actualDownload(filename) {
            const downloadUrl = `uploads/${encodeURIComponent(filename)}`;
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = filename;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            const resultDiv = document.getElementById('downloadResult');
            resultDiv.innerHTML += `<p><strong>ğŸ“¥ ä¸‹è½½å·²è§¦å‘</strong></p>`;
        }

        // æ£€æŸ¥åŠŸèƒ½çŠ¶æ€
        function checkFunctionStatus() {
            const statusDiv = document.getElementById('statusCheck');
            let status = [];
            
            // æ£€æŸ¥ DocumentContentExtractor
            if (window.DocumentContentExtractor) {
                status.push('âœ… DocumentContentExtractor å·²åŠ è½½');
            } else {
                status.push('âŒ DocumentContentExtractor æœªåŠ è½½');
            }
            
            // æ£€æŸ¥èµ„æºåº“å‡½æ•°
            if (typeof showDocumentPreview === 'function') {
                status.push('âœ… showDocumentPreview å‡½æ•°å¯ç”¨');
            } else {
                status.push('âŒ showDocumentPreview å‡½æ•°ä¸å¯ç”¨');
            }
            
            if (typeof downloadDocument === 'function') {
                status.push('âœ… downloadDocument å‡½æ•°å¯ç”¨');
            } else {
                status.push('âŒ downloadDocument å‡½æ•°ä¸å¯ç”¨');
            }
            
            statusDiv.innerHTML = status.map(s => `<p>${s}</p>`).join('');
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkFunctionStatus, 1000);
        });
    </script>
</body>
</html>
