<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ»šåŠ¨åŠ è½½åŠŸèƒ½æµ‹è¯•</title>
    <link rel="stylesheet" href="styles/common.css">
    <link rel="stylesheet" href="styles/resource-library.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #f5f6fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .test-container {
            max-width: 800px;
            margin: 20px auto;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .test-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .test-content {
            padding: 20px;
        }
        
        .test-section {
            margin-bottom: 24px;
            padding: 16px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .test-section h4 {
            margin: 0 0 12px 0;
            color: #333;
            font-size: 14px;
            font-weight: 600;
        }
        
        .demo-scroll-area {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            padding: 16px;
        }
        
        .demo-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid #e9ecef;
        }
        
        .demo-icon {
            width: 40px;
            height: 40px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            color: white;
        }
        
        .demo-pdf { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); }
        .demo-video { background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); }
        .demo-doc { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); }
        .demo-ppt { background: linear-gradient(135deg, #e67e22 0%, #d35400 100%); }
        .demo-excel { background: linear-gradient(135deg, #27ae60 0%, #229954 100%); }
        
        .demo-content {
            flex: 1;
        }
        
        .demo-title {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin: 0 0 4px 0;
        }
        
        .demo-desc {
            font-size: 12px;
            color: #666;
            margin: 0 0 8px 0;
        }
        
        .demo-meta {
            font-size: 11px;
            color: #999;
            display: flex;
            gap: 12px;
        }
        
        .demo-loading {
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #666;
            font-size: 14px;
            gap: 12px;
        }
        
        .demo-loading.show {
            display: flex;
        }
        
        .demo-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .test-btn {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .test-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .test-btn.secondary {
            background: #28a745;
            color: white;
        }
        
        .test-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.success {
            background: #28a745;
        }
        
        .test-result {
            margin: 8px 0;
            padding: 8px;
            border-radius: 4px;
            font-size: 13px;
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .scroll-stats {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
            border: 1px solid #ddd;
            font-size: 13px;
        }
        
        .scroll-stats strong {
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h2>ğŸ“œ æ»šåŠ¨åŠ è½½åŠŸèƒ½æµ‹è¯•</h2>
            <p>æµ‹è¯•ç§»åŠ¨äº‘èµ„æºåº“é¡µé¢çš„æ»šåŠ¨è‡ªåŠ¨åŠ è½½åŠŸèƒ½</p>
        </div>
        
        <div class="test-content">
            <!-- åŠŸèƒ½è¯´æ˜ -->
            <div class="test-section">
                <h4>åŠŸèƒ½æ”¹è¿›è¯´æ˜</h4>
                <div class="test-result">
                    <span class="status-indicator success"></span>
                    <strong>ç§»é™¤"åŠ è½½æ›´å¤š"æŒ‰é’®ï¼š</strong>ä¸å†éœ€è¦æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®
                </div>
                <div class="test-result">
                    <span class="status-indicator success"></span>
                    <strong>æ»šåŠ¨è‡ªåŠ¨åŠ è½½ï¼š</strong>æ»šåŠ¨åˆ°åº•éƒ¨è‡ªåŠ¨åŠ è½½æ–°å†…å®¹
                </div>
                <div class="test-result">
                    <span class="status-indicator success"></span>
                    <strong>åŠ è½½çŠ¶æ€æç¤ºï¼š</strong>æ˜¾ç¤ºåŠ è½½åŠ¨ç”»å’Œæ–‡å­—æç¤º
                </div>
                <div class="test-result">
                    <span class="status-indicator success"></span>
                    <strong>æ•°æ®ç®¡ç†ï¼š</strong>è‡ªåŠ¨ç®¡ç†é¡µç å’Œæ•°æ®çŠ¶æ€
                </div>
            </div>
            
            <!-- æ»šåŠ¨åŠ è½½æ¼”ç¤º -->
            <div class="test-section">
                <h4>æ»šåŠ¨åŠ è½½æ¼”ç¤º</h4>
                <p>åœ¨ä¸‹æ–¹åŒºåŸŸä¸­æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œè§‚å¯Ÿè‡ªåŠ¨åŠ è½½æ•ˆæœï¼š</p>
                
                <div class="demo-scroll-area" id="demoScrollArea">
                    <div id="demoItemList">
                        <!-- åˆå§‹å†…å®¹å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                    </div>
                    
                    <div class="demo-loading" id="demoLoading">
                        <div class="demo-spinner"></div>
                        <span>æ­£åœ¨åŠ è½½æ›´å¤š...</span>
                    </div>
                </div>
                
                <div class="scroll-stats" id="scrollStats">
                    <strong>åŠ è½½ç»Ÿè®¡ï¼š</strong>å·²åŠ è½½ <span id="loadedCount">0</span> é¡µï¼Œ
                    å…± <span id="totalItems">0</span> ä¸ªæ–‡æ¡£
                </div>
            </div>
            
            <!-- åŠŸèƒ½ç‰¹æ€§ -->
            <div class="test-section">
                <h4>åŠŸèƒ½ç‰¹æ€§éªŒè¯</h4>
                <div class="test-result">
                    <span class="status-indicator success"></span>
                    <strong>è§¦å‘è·ç¦»ï¼š</strong>è·ç¦»åº•éƒ¨100pxæ—¶å¼€å§‹åŠ è½½
                </div>
                <div class="test-result">
                    <span class="status-indicator success"></span>
                    <strong>åŠ è½½åŠ¨ç”»ï¼š</strong>æ—‹è½¬åŠ è½½å™¨ + æ–‡å­—æç¤º
                </div>
                <div class="test-result">
                    <span class="status-indicator success"></span>
                    <strong>é˜²é‡å¤åŠ è½½ï¼š</strong>åŠ è½½ä¸­æ—¶ä¸ä¼šé‡å¤è§¦å‘
                </div>
                <div class="test-result">
                    <span class="status-indicator success"></span>
                    <strong>æ•°æ®å®Œç»“ï¼š</strong>æ²¡æœ‰æ›´å¤šæ•°æ®æ—¶åœæ­¢åŠ è½½
                </div>
                <div class="test-result">
                    <span class="status-indicator success"></span>
                    <strong>é”™è¯¯å¤„ç†ï¼š</strong>åŠ è½½å¤±è´¥æ—¶çš„é”™è¯¯æç¤º
                </div>
            </div>
            
            <!-- æµ‹è¯•æ§åˆ¶ -->
            <div class="test-section">
                <h4>æµ‹è¯•æ§åˆ¶</h4>
                <button class="test-btn primary" onclick="resetDemo()">
                    ğŸ”„ é‡ç½®æ¼”ç¤º
                </button>
                <button class="test-btn primary" onclick="simulateError()">
                    âš ï¸ æ¨¡æ‹ŸåŠ è½½é”™è¯¯
                </button>
                <button class="test-btn secondary" onclick="window.open('resource-library.html', '_blank')">
                    ğŸ“š æ‰“å¼€èµ„æºåº“é¡µé¢
                </button>
            </div>
        </div>
    </div>

    <script src="scripts/common.js"></script>
    <script>
        let demoPage = 1;
        let demoIsLoading = false;
        let demoHasMore = true;
        let demoTotalItems = 0;
        let simulateErrorNext = false;
        
        const documentTypes = [
            { class: 'demo-pdf', text: 'PDF' },
            { class: 'demo-video', text: 'MP4' },
            { class: 'demo-doc', text: 'DOC' },
            { class: 'demo-ppt', text: 'PPT' },
            { class: 'demo-excel', text: 'XLS' }
        ];
        
        const titles = [
            'äº‘åŸç”Ÿæ¶æ„è®¾è®¡æŒ‡å—',
            'å¾®æœåŠ¡æ²»ç†æœ€ä½³å®è·µ',
            'å®¹å™¨åŒ–éƒ¨ç½²å®æˆ˜æ‰‹å†Œ',
            'DevOpsæµç¨‹ä¼˜åŒ–æ–¹æ¡ˆ',
            'æ•°æ®åº“æ€§èƒ½è°ƒä¼˜æŒ‡å—',
            'ç½‘ç»œå®‰å…¨é˜²æŠ¤ç­–ç•¥',
            'ç§»åŠ¨åº”ç”¨å¼€å‘è§„èŒƒ',
            'å¤§æ•°æ®åˆ†æå¹³å°æ­å»º',
            'äººå·¥æ™ºèƒ½ç®—æ³•å®è·µ',
            'åŒºå—é“¾æŠ€æœ¯åº”ç”¨æ¡ˆä¾‹'
        ];
        
        function generateDemoItems(page) {
            if (page > 5) return []; // æœ€å¤š5é¡µ
            
            const items = [];
            for (let i = 0; i < 4; i++) { // æ¯é¡µ4ä¸ªé¡¹ç›®
                const typeInfo = documentTypes[Math.floor(Math.random() * documentTypes.length)];
                const titleIndex = ((page - 1) * 4 + i) % titles.length;
                
                items.push({
                    id: `demo_${page}_${i}`,
                    title: titles[titleIndex],
                    description: `è¿™æ˜¯ç¬¬${page}é¡µç¬¬${i + 1}ä¸ªæ–‡æ¡£çš„è¯¦ç»†æè¿°ä¿¡æ¯`,
                    type: typeInfo,
                    size: `${(Math.random() * 5 + 0.5).toFixed(1)}MB`,
                    date: `2024-01-${String(Math.floor(Math.random() * 28) + 1).padStart(2, '0')}`
                });
            }
            
            return items;
        }
        
        function createDemoItem(item) {
            return `
                <div class="demo-item">
                    <div class="demo-icon ${item.type.class}">
                        ${item.type.text}
                    </div>
                    <div class="demo-content">
                        <h4 class="demo-title">${item.title}</h4>
                        <p class="demo-desc">${item.description}</p>
                        <div class="demo-meta">
                            <span>${item.size}</span>
                            <span>${item.date}</span>
                            <span>é¡µé¢${Math.floor((demoTotalItems) / 4) + 1}</span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function loadDemoData() {
            if (demoIsLoading || !demoHasMore) return;
            
            demoIsLoading = true;
            const loadingElement = document.getElementById('demoLoading');
            loadingElement.classList.add('show');
            
            // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
            setTimeout(() => {
                if (simulateErrorNext) {
                    // æ¨¡æ‹Ÿé”™è¯¯
                    simulateErrorNext = false;
                    demoIsLoading = false;
                    loadingElement.classList.remove('show');
                    
                    if (typeof commonUtils !== 'undefined' && commonUtils.showToast) {
                        commonUtils.showToast('åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                    } else {
                        alert('âŒ æ¨¡æ‹ŸåŠ è½½é”™è¯¯ï¼');
                    }
                    return;
                }
                
                const newItems = generateDemoItems(demoPage);
                
                if (newItems.length > 0) {
                    const itemList = document.getElementById('demoItemList');
                    newItems.forEach(item => {
                        itemList.innerHTML += createDemoItem(item);
                        demoTotalItems++;
                    });
                    
                    demoPage++;
                    demoHasMore = demoPage <= 5;
                } else {
                    demoHasMore = false;
                    if (typeof commonUtils !== 'undefined' && commonUtils.showToast) {
                        commonUtils.showToast('æ²¡æœ‰æ›´å¤šæ•°æ®äº†', 'info');
                    }
                }
                
                demoIsLoading = false;
                loadingElement.classList.remove('show');
                updateStats();
            }, 1500);
        }
        
        function updateStats() {
            document.getElementById('loadedCount').textContent = demoPage - 1;
            document.getElementById('totalItems').textContent = demoTotalItems;
        }
        
        function resetDemo() {
            demoPage = 1;
            demoIsLoading = false;
            demoHasMore = true;
            demoTotalItems = 0;
            simulateErrorNext = false;
            
            document.getElementById('demoItemList').innerHTML = '';
            document.getElementById('demoLoading').classList.remove('show');
            
            // åŠ è½½åˆå§‹æ•°æ®
            loadDemoData();
        }
        
        function simulateError() {
            simulateErrorNext = true;
            alert('âš ï¸ ä¸‹æ¬¡æ»šåŠ¨åŠ è½½å°†æ¨¡æ‹Ÿé”™è¯¯æƒ…å†µ');
        }
        
        // åˆå§‹åŒ–æ¼”ç¤º
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“œ æ»šåŠ¨åŠ è½½åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½');
            
            // è®¾ç½®æ»šåŠ¨ç›‘å¬
            const scrollArea = document.getElementById('demoScrollArea');
            scrollArea.addEventListener('scroll', function() {
                if (demoIsLoading || !demoHasMore) return;
                
                const scrollTop = this.scrollTop;
                const scrollHeight = this.scrollHeight;
                const clientHeight = this.clientHeight;
                
                // è·ç¦»åº•éƒ¨50pxæ—¶å¼€å§‹åŠ è½½
                if (scrollTop + clientHeight >= scrollHeight - 50) {
                    loadDemoData();
                }
            });
            
            // åŠ è½½åˆå§‹æ•°æ®
            resetDemo();
            
            console.log('âœ… æ»šåŠ¨åŠ è½½æ¼”ç¤ºå·²å°±ç»ª');
        });
    </script>
</body>
</html>
