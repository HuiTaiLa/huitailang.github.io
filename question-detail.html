<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—®é¢˜è¯¦æƒ… - ç§»åŠ¨äº‘ä¸šåŠ¡æ”¯æ’‘å°ç¨‹åº</title>
    <link rel="stylesheet" href="styles/common.css">
    <link rel="stylesheet" href="styles/qa-system.css">
    <link rel="stylesheet" href="styles/question-detail.css">
    <style>
        /* é¡µé¢ç‰¹å®šçš„è¦†ç›–æ ·å¼ */
        body {
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="question-detail-page">
        <!-- å¤´éƒ¨å¯¼èˆª -->
        <div class="detail-header">
            <button class="back-btn" onclick="goBack()">
                <span class="back-arrow">â€¹</span>
            </button>
            <h1>é—®é¢˜è¯¦æƒ…</h1>
            <button class="share-btn" onclick="shareQuestion()">
                <span>â‹¯</span>
            </button>
        </div>
        
        <!-- å†…å®¹åŒºåŸŸ -->
        <div class="detail-content">
            <!-- åŠ è½½çŠ¶æ€ -->
            <div id="loadingContainer" class="question-detail-card">
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <div>æ­£åœ¨åŠ è½½é—®é¢˜è¯¦æƒ…...</div>
                </div>
            </div>
            
            <!-- é”™è¯¯çŠ¶æ€ -->
            <div id="errorContainer" class="question-detail-card" style="display: none;">
                <div class="error-container">
                    <div class="error-icon">ğŸ˜•</div>
                    <div class="error-message">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</div>
                    <button class="retry-btn" onclick="loadQuestionDetail()">é‡æ–°åŠ è½½</button>
                </div>
            </div>
            
            <!-- é—®é¢˜è¯¦æƒ…å†…å®¹ -->
            <div id="questionDetailContainer" style="display: none;">
                <!-- é—®é¢˜ä¿¡æ¯å¡ç‰‡ -->
                <div class="question-detail-card">
                    <div class="question-detail-header">
                        <div class="question-detail-status" id="questionStatus"></div>
                        <div class="question-detail-priority" id="questionPriority"></div>
                    </div>
                    
                    <h2 class="question-detail-title" id="questionTitle"></h2>
                    
                    <div class="question-detail-meta">
                        <div class="question-detail-user">
                            <img id="userAvatar" alt="æé—®è€…" class="user-avatar">
                            <div class="user-info">
                                <div class="user-name" id="userName"></div>
                                <div class="user-role" id="userRole"></div>
                            </div>
                        </div>
                        <div class="question-detail-time" id="questionTime"></div>
                    </div>
                    
                    <div class="question-detail-content" id="questionContent"></div>
                    
                    <div class="question-detail-tags" id="questionTags"></div>
                    
                    <div class="question-detail-stats">
                        <span id="questionViews"></span>
                        <span id="questionFollowers"></span>
                        <span id="questionAnswers"></span>
                    </div>
                </div>
                
                <!-- ä¸“å®¶å›ç­”å¡ç‰‡ -->
                <div class="question-detail-card" id="answersContainer" style="display: none;">
                    <div class="question-answers">
                        <h4 id="answersTitle">ä¸“å®¶å›ç­”</h4>
                        <div id="answersList"></div>
                    </div>
                </div>
                
                <!-- æ“ä½œæŒ‰é’® -->
                <div class="question-detail-card">
                    <div class="modal-footer" style="border-top: none; padding: 0; justify-content: center;">
                        <button class="cancel-btn" onclick="goBack()" style="margin-right: 12px;">è¿”å›åˆ—è¡¨</button>
                        <button class="submit-btn" onclick="answerQuestion()">ğŸ’¡ æˆ‘æ¥å›ç­”</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="scripts/common.js"></script>
    <script src="scripts/qa-system.js"></script>
    <script>
        let currentQuestionId = null;
        
        // é¡µé¢åŠ è½½æ—¶è·å–é—®é¢˜IDå¹¶åŠ è½½è¯¦æƒ…
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            currentQuestionId = urlParams.get('id');
            
            console.log('é—®é¢˜è¯¦æƒ…é¡µé¢åŠ è½½ï¼Œé—®é¢˜ID:', currentQuestionId);
            
            if (currentQuestionId) {
                loadQuestionDetail();
            } else {
                showError('é—®é¢˜IDä¸å­˜åœ¨');
            }
        });
        
        // åŠ è½½é—®é¢˜è¯¦æƒ…
        function loadQuestionDetail() {
            if (!currentQuestionId) {
                showError('é—®é¢˜IDä¸å­˜åœ¨');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loadingContainer').style.display = 'block';
            document.getElementById('errorContainer').style.display = 'none';
            document.getElementById('questionDetailContainer').style.display = 'none';
            
            // æ¨¡æ‹ŸAPIè°ƒç”¨
            setTimeout(() => {
                const questionData = getQuestionData(currentQuestionId);
                
                if (questionData) {
                    displayQuestionDetail(questionData);
                } else {
                    showError('é—®é¢˜ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤');
                }
            }, 1000);
        }
        
        // æ˜¾ç¤ºé—®é¢˜è¯¦æƒ…
        function displayQuestionDetail(data) {
            // éšè—åŠ è½½çŠ¶æ€
            document.getElementById('loadingContainer').style.display = 'none';
            document.getElementById('errorContainer').style.display = 'none';
            document.getElementById('questionDetailContainer').style.display = 'block';
            
            // å¡«å……é—®é¢˜ä¿¡æ¯
            document.getElementById('questionStatus').textContent = getStatusText(data.status);
            document.getElementById('questionStatus').className = `question-detail-status ${data.status}`;
            
            document.getElementById('questionPriority').textContent = getPriorityText(data.priority);
            document.getElementById('questionPriority').className = `question-detail-priority ${data.priority}`;
            
            document.getElementById('questionTitle').textContent = data.title;
            document.getElementById('questionContent').innerHTML = `<p>${data.content}</p>`;
            
            document.getElementById('userAvatar').src = data.avatar;
            document.getElementById('userName').textContent = data.username;
            document.getElementById('userRole').textContent = data.role;
            document.getElementById('questionTime').textContent = data.time;
            
            // å¡«å……æ ‡ç­¾
            const tagsContainer = document.getElementById('questionTags');
            tagsContainer.innerHTML = data.tags.map(tag => 
                `<span class="question-tag">${tag}</span>`
            ).join('');
            
            // å¡«å……ç»Ÿè®¡ä¿¡æ¯
            document.getElementById('questionViews').textContent = `ğŸ‘ ${data.views}æ¬¡æµè§ˆ`;
            document.getElementById('questionFollowers').textContent = `ğŸ‘¥ ${data.followers}äººå…³æ³¨`;
            document.getElementById('questionAnswers').textContent = `ğŸ’¬ ${data.answers}ä¸ªå›ç­”`;
            
            // æ˜¾ç¤ºä¸“å®¶å›ç­”
            if (data.answers > 0 && data.answerList && data.answerList.length > 0) {
                document.getElementById('answersContainer').style.display = 'block';
                document.getElementById('answersTitle').textContent = `ä¸“å®¶å›ç­” (${data.answers})`;
                
                const answersHtml = data.answerList.map(answer => `
                    <div class="answer-item">
                        <div class="answer-header">
                            <img src="${answer.avatar}" alt="ä¸“å®¶" class="expert-avatar">
                            <div class="expert-info">
                                <div class="expert-name">${answer.expertName}</div>
                                <div class="expert-title">${answer.expertTitle}</div>
                            </div>
                            <div class="answer-time">${answer.time}</div>
                        </div>
                        <div class="answer-content">${answer.content}</div>
                        <div class="answer-actions">
                            <button class="like-btn">ğŸ‘ ${answer.likes}</button>
                            <button class="reply-btn">ğŸ’¬ å›å¤</button>
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('answersList').innerHTML = answersHtml;
            }
            
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = `${data.title} - é—®é¢˜è¯¦æƒ…`;
        }
        
        // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
        function showError(message) {
            document.getElementById('loadingContainer').style.display = 'none';
            document.getElementById('questionDetailContainer').style.display = 'none';
            document.getElementById('errorContainer').style.display = 'block';
            document.querySelector('.error-message').textContent = message;
        }
        
        // è¿”å›ä¸Šä¸€é¡µ
        function goBack() {
            if (document.referrer && document.referrer.includes('qa-system.html')) {
                history.back();
            } else {
                window.location.href = 'qa-system.html';
            }
        }
        
        // åˆ†äº«é—®é¢˜
        function shareQuestion() {
            if (navigator.share && currentQuestionId) {
                const questionTitle = document.getElementById('questionTitle')?.textContent || 'é—®é¢˜è¯¦æƒ…';
                navigator.share({
                    title: questionTitle,
                    text: 'æŸ¥çœ‹è¿™ä¸ªæŠ€æœ¯é—®é¢˜çš„è¯¦æƒ…',
                    url: window.location.href
                }).catch(console.error);
            } else {
                // å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿
                navigator.clipboard.writeText(window.location.href).then(() => {
                    commonUtils.showToast('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                }).catch(() => {
                    commonUtils.showToast('åˆ†äº«åŠŸèƒ½æš‚ä¸å¯ç”¨', 'info');
                });
            }
        }
        
        // å›ç­”é—®é¢˜
        function answerQuestion() {
            commonUtils.showToast('è·³è½¬åˆ°å›ç­”é¡µé¢...', 'info');
            setTimeout(() => {
                alert(`åŠŸèƒ½å¼€å‘ä¸­ï¼šå›ç­”é—®é¢˜ ${currentQuestionId}`);
            }, 500);
        }
    </script>
</body>
</html>
