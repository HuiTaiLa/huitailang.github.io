<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠå¤©èœå•è°ƒè¯•é¡µé¢</title>
    <link rel="stylesheet" href="styles/common.css">
    <link rel="stylesheet" href="styles/chat.css">
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <header class="header">
            <div class="header-content">
                <button class="back-btn" onclick="history.back()">
                    <span class="back-arrow">â€¹</span>
                </button>
                <div class="chat-info">
                    <h1 id="chatTitle">ç§»åŠ¨äº‘æŠ€æœ¯æ”¯æŒç¾¤</h1>
                    <span class="online-count" id="onlineCount">89äººåœ¨çº¿</span>
                </div>
                <button class="more-btn" onclick="testShowChatMenu()">
                    <span class="more-icon">â‹¯</span>
                </button>
            </div>
        </header>

        <!-- èŠå¤©æ¶ˆæ¯åŒºåŸŸ -->
        <div class="chat-messages">
            <div class="message-item">
                <div class="message-avatar">ğŸ‘¨â€ğŸ’¼</div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="sender-name">å¼ å·¥ç¨‹å¸ˆ</span>
                        <span class="message-time">14:30</span>
                    </div>
                    <div class="message-text">å¤§å®¶å¥½ï¼Œä»Šå¤©æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹ç§»åŠ¨äº‘å¹³å°çš„æœ€æ–°æŠ€æœ¯æ›´æ–°ã€‚</div>
                </div>
            </div>
            
            <div class="message-item">
                <div class="message-avatar">ğŸ‘©â€ğŸ’»</div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="sender-name">ææŠ€æœ¯</span>
                        <span class="message-time">14:32</span>
                    </div>
                    <div class="message-text">å¥½çš„ï¼Œæˆ‘å‡†å¤‡äº†ä¸€äº›æŠ€æœ¯æ–‡æ¡£ï¼Œç¨ååˆ†äº«ç»™å¤§å®¶ã€‚</div>
                </div>
            </div>
        </div>

        <!-- è¾“å…¥åŒºåŸŸ -->
        <div class="chat-input-container">
            <div class="input-toolbar">
                <button class="tool-btn" onclick="showEmoji()">
                    <span>ğŸ˜Š</span>
                </button>
                <button class="tool-btn" onclick="uploadFile()">
                    <span>ğŸ“</span>
                </button>
                <button class="tool-btn" onclick="showAIAssist()">
                    <span>ğŸ¤–</span>
                </button>
            </div>
            <div class="input-area">
                <input type="text" class="message-input" placeholder="è¾“å…¥æ¶ˆæ¯..." id="messageInput">
                <button class="send-btn" onclick="sendMessage()">
                    <span>â¤</span>
                </button>
            </div>
        </div>
    </div>

    <!-- èŠå¤©èœå•æ¨¡æ€æ¡† -->
    <div id="chatMenuModal" class="modal" style="display: none;">
        <div class="modal-content chat-menu-content">
            <div class="modal-header">
                <h3>èŠå¤©èœå•</h3>
                <button class="close-btn" onclick="closeChatMenu()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="chat-info-section">
                    <div class="chat-avatar-large">ğŸ‘¥</div>
                    <div class="chat-details">
                        <h4>ç§»åŠ¨äº‘æŠ€æœ¯æ”¯æŒç¾¤</h4>
                        <p>ç¾¤æˆå‘˜ 89äºº</p>
                    </div>
                </div>
                <div class="menu-list">
                    <div class="menu-item" onclick="showGroupMembers()">
                        <span class="menu-icon">ğŸ‘¥</span>
                        <span>ç¾¤æˆå‘˜åˆ—è¡¨</span>
                        <span class="menu-badge">89</span>
                        <span class="menu-arrow">â€º</span>
                    </div>
                    <div class="menu-item" onclick="showGroupInfo()">
                        <span class="menu-icon">â„¹ï¸</span>
                        <span>ç¾¤èŠä¿¡æ¯</span>
                        <span class="menu-arrow">â€º</span>
                    </div>
                    <div class="menu-item" onclick="showGroupFiles()">
                        <span class="menu-icon">ğŸ“</span>
                        <span>ç¾¤æ–‡ä»¶</span>
                        <span class="menu-arrow">â€º</span>
                    </div>
                    <div class="menu-item" onclick="searchInChat()">
                        <span class="menu-icon">ğŸ”</span>
                        <span>èŠå¤©è®°å½•æœç´¢</span>
                        <span class="menu-arrow">â€º</span>
                    </div>
                    <div class="menu-item" onclick="clearChatHistory()">
                        <span class="menu-icon">ğŸ—‘ï¸</span>
                        <span>æ¸…ç©ºèŠå¤©è®°å½•</span>
                        <span class="menu-arrow">â€º</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è°ƒè¯•ä¿¡æ¯ -->
    <div id="debugInfo" style="position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; font-size: 12px; z-index: 2000;">
        <div>è°ƒè¯•æ¨¡å¼</div>
        <div id="debugLog"></div>
    </div>

    <script src="scripts/common.js"></script>
    <script>
        // è°ƒè¯•æ—¥å¿—å‡½æ•°
        function debugLog(message) {
            console.log('[DEBUG]', message);
            const debugLogElement = document.getElementById('debugLog');
            debugLogElement.innerHTML += '<div>' + message + '</div>';
        }

        // æµ‹è¯•æ˜¾ç¤ºèŠå¤©èœå•å‡½æ•°
        function testShowChatMenu() {
            debugLog('testShowChatMenu è¢«è°ƒç”¨');
            
            const modal = document.getElementById('chatMenuModal');
            debugLog('æ‰¾åˆ°æ¨¡æ€æ¡†: ' + (modal ? 'YES' : 'NO'));
            
            if (modal) {
                debugLog('è®¾ç½®æ¨¡æ€æ¡†æ˜¾ç¤º');
                modal.style.display = 'flex';
                
                // æ·»åŠ åŠ¨ç”»æ•ˆæœ
                setTimeout(() => {
                    debugLog('æ·»åŠ showç±»');
                    modal.classList.add('show');
                }, 10);
            } else {
                debugLog('æ¨¡æ€æ¡†ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„');
                alert('æ¨¡æ€æ¡†ä¸å­˜åœ¨ï¼');
            }
        }

        // å…³é—­èŠå¤©èœå•
        function closeChatMenu() {
            debugLog('closeChatMenu è¢«è°ƒç”¨');
            const modal = document.getElementById('chatMenuModal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            }
        }

        // ç¾¤æˆå‘˜åˆ—è¡¨
        function showGroupMembers() {
            closeChatMenu();
            alert('ç¾¤æˆå‘˜åˆ—è¡¨åŠŸèƒ½');
        }

        // ç¾¤èŠä¿¡æ¯
        function showGroupInfo() {
            closeChatMenu();
            alert('ç¾¤èŠä¿¡æ¯åŠŸèƒ½');
        }

        // ç¾¤æ–‡ä»¶
        function showGroupFiles() {
            closeChatMenu();
            alert('ç¾¤æ–‡ä»¶åŠŸèƒ½');
        }

        // æœç´¢èŠå¤©è®°å½•
        function searchInChat() {
            closeChatMenu();
            const keyword = prompt('è¯·è¾“å…¥æœç´¢å…³é”®è¯ï¼š');
            if (keyword) {
                alert('æœç´¢å…³é”®è¯ï¼š' + keyword);
            }
        }

        // æ¸…ç©ºèŠå¤©è®°å½•
        function clearChatHistory() {
            closeChatMenu();
            if (confirm('ç¡®å®šè¦æ¸…ç©ºèŠå¤©è®°å½•å—ï¼Ÿ')) {
                alert('èŠå¤©è®°å½•å·²æ¸…ç©º');
            }
        }

        // å…¶ä»–å ä½å‡½æ•°
        function showEmoji() {
            alert('è¡¨æƒ…åŠŸèƒ½');
        }

        function uploadFile() {
            alert('æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½');
        }

        function showAIAssist() {
            alert('AIåŠ©æ‰‹åŠŸèƒ½');
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            if (input.value.trim()) {
                alert('å‘é€æ¶ˆæ¯ï¼š' + input.value);
                input.value = '';
            }
        }

        // æ·»åŠ ç‚¹å‡»èƒŒæ™¯å…³é—­æ¨¡æ€æ¡†çš„åŠŸèƒ½
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                debugLog('ç‚¹å‡»èƒŒæ™¯å…³é—­æ¨¡æ€æ¡†');
                e.target.style.display = 'none';
                e.target.classList.remove('show');
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('é¡µé¢åŠ è½½å®Œæˆ');
            debugLog('æ¨¡æ€æ¡†å­˜åœ¨: ' + (document.getElementById('chatMenuModal') ? 'YES' : 'NO'));
            
            // æµ‹è¯•æŒ‰é’®ç‚¹å‡»
            const moreBtn = document.querySelector('.more-btn');
            debugLog('æ›´å¤šæŒ‰é’®å­˜åœ¨: ' + (moreBtn ? 'YES' : 'NO'));
            
            if (moreBtn) {
                debugLog('æ›´å¤šæŒ‰é’®onclick: ' + moreBtn.getAttribute('onclick'));
            }
        });

        // ç›‘å¬æ‰€æœ‰é”™è¯¯
        window.addEventListener('error', function(e) {
            debugLog('JavaScripté”™è¯¯: ' + e.message);
        });
    </script>
</body>
</html>
