<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†ç±»ç­›é€‰å®Œæ•´æµ‹è¯•</title>
    <link rel="stylesheet" href="styles/common.css">
    <link rel="stylesheet" href="styles/resource-library.css">
    <style>
        .test-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 350px;
            background: white;
            border: 2px solid #007bff;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            max-height: 80vh;
            overflow-y: auto;
        }
        .test-panel h3 {
            margin-top: 0;
            color: #007bff;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .test-button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-result {
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        
        .stats-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-size: 12px;
        }
        
        .toggle-panel {
            position: fixed;
            top: 20px;
            right: 380px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            z-index: 1001;
        }
    </style>
</head>
<body>
    <button class="toggle-panel" onclick="toggleTestPanel()">ğŸ§ª æµ‹è¯•é¢æ¿</button>
    
    <div id="testPanel" class="test-panel">
        <h3>ğŸ§ª åˆ†ç±»ç­›é€‰æµ‹è¯•</h3>
        
        <div class="stats-display" id="statsDisplay">
            <strong>å½“å‰çŠ¶æ€ï¼š</strong><br>
            åˆ†ç±»: <span id="currentCategoryDisplay">-</span><br>
            ç­›é€‰æ–‡ä»¶: <span id="filteredCountDisplay">-</span><br>
            æ˜¾ç¤ºæ–‡ä»¶: <span id="displayedCountDisplay">-</span><br>
            çƒ­é—¨æ¨è: <span id="hotCountDisplay">-</span>
        </div>
        
        <button class="test-button" onclick="testCategory('all')">æµ‹è¯•å…¨éƒ¨åˆ†ç±»</button>
        <button class="test-button" onclick="testCategory('manual')">æµ‹è¯•äº§å“æ‰‹å†Œ</button>
        <button class="test-button" onclick="testCategory('solution')">æµ‹è¯•è§£å†³æ–¹æ¡ˆ</button>
        <button class="test-button" onclick="testCategory('training')">æµ‹è¯•åŸ¹è®­èµ„æ–™</button>
        <button class="test-button" onclick="testCategory('case')">æµ‹è¯•å®¢æˆ·æ¡ˆä¾‹</button>
        
        <hr>
        
        <button class="test-button" onclick="testUrlParameter('manual')">æµ‹è¯•URLå‚æ•°(æ‰‹å†Œ)</button>
        <button class="test-button" onclick="testUrlParameter('solution')">æµ‹è¯•URLå‚æ•°(æ–¹æ¡ˆ)</button>
        <button class="test-button" onclick="testScrollLoad()">æµ‹è¯•æ»šåŠ¨åŠ è½½</button>
        <button class="test-button" onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        
        <div id="testResults"></div>
    </div>

    <div class="container">
        <!-- æœç´¢æ  -->
        <div class="search-section">
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="æœç´¢æ–‡æ¡£èµ„æº...">
                <button class="search-btn">ğŸ”</button>
            </div>
        </div>

        <!-- åˆ†ç±»å¯¼èˆª -->
        <div class="category-nav">
            <div class="tab-scroll">
                <div class="tab-item active" data-category="all">å…¨éƒ¨</div>
                <div class="tab-item" data-category="manual">äº§å“æ‰‹å†Œ</div>
                <div class="tab-item" data-category="solution">è§£å†³æ–¹æ¡ˆ</div>
                <div class="tab-item" data-category="training">åŸ¹è®­èµ„æ–™</div>
                <div class="tab-item" data-category="case">å®¢æˆ·æ¡ˆä¾‹</div>
            </div>
        </div>

        <!-- çƒ­é—¨æ¨è -->
        <div class="hot-section">
            <h3>ğŸ”¥ çƒ­é—¨æ¨è</h3>
            <div class="hot-list">
                <!-- çƒ­é—¨æ¨èå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
        </div>

        <!-- æ–‡æ¡£åˆ—è¡¨ -->
        <div class="document-list">
            <div class="list-header">
                <h3>æ–‡æ¡£èµ„æº</h3>
                <div class="sort-options">
                    <select class="sort-select">
                        <option value="latest">æœ€æ–°æ›´æ–°</option>
                        <option value="popular">çƒ­é—¨ä¸‹è½½</option>
                        <option value="rating">è¯„åˆ†æœ€é«˜</option>
                    </select>
                </div>
            </div>

            <div class="document-items">
                <!-- æ–‡æ¡£åˆ—è¡¨å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>

            <!-- æ»šåŠ¨åŠ è½½æç¤º -->
            <div class="scroll-loading" id="scrollLoading" style="display: none;">
                <div class="loading-spinner"></div>
                <span class="loading-text">æ­£åœ¨åŠ è½½æ›´å¤š...</span>
            </div>
        </div>
    </div>

    <!-- åŠ è½½æç¤º -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <div class="loading-text">åŠ è½½ä¸­...</div>
    </div>

    <!-- å¼•å…¥è„šæœ¬ -->
    <script src="scripts/safe-utils.js"></script>
    <script src="scripts/common.js"></script>
    <script src="scripts/resource-library.js"></script>
    
    <script>
        let testPanelVisible = true;
        
        function toggleTestPanel() {
            const panel = document.getElementById('testPanel');
            testPanelVisible = !testPanelVisible;
            panel.style.display = testPanelVisible ? 'block' : 'none';
        }
        
        function addTestResult(message, type = 'info') {
            const results = document.getElementById('testResults');
            const result = document.createElement('div');
            result.className = `test-result ${type}`;
            result.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(result);
            results.scrollTop = results.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function updateStats() {
            document.getElementById('currentCategoryDisplay').textContent = 
                typeof currentCategory !== 'undefined' ? currentCategory : 'æœªå®šä¹‰';
            document.getElementById('filteredCountDisplay').textContent = 
                typeof filteredFiles !== 'undefined' ? filteredFiles.length : 'æœªå®šä¹‰';
            document.getElementById('displayedCountDisplay').textContent = 
                typeof displayedFiles !== 'undefined' ? displayedFiles.length : 'æœªå®šä¹‰';
            document.getElementById('hotCountDisplay').textContent = 
                document.querySelectorAll('.hot-item').length;
        }
        
        function testCategory(category) {
            addTestResult(`å¼€å§‹æµ‹è¯•åˆ†ç±»: ${category}`, 'info');
            
            // ç‚¹å‡»åˆ†ç±»æ ‡ç­¾
            const tab = document.querySelector(`.tab-item[data-category="${category}"]`);
            if (tab) {
                tab.click();
                addTestResult(`ç‚¹å‡»åˆ†ç±»æ ‡ç­¾: ${category}`, 'success');
                
                // ç­‰å¾…åŠ è½½å®Œæˆåæ£€æŸ¥ç»“æœ
                setTimeout(() => {
                    validateCategoryFilter(category);
                    updateStats();
                }, 1500);
            } else {
                addTestResult(`æ‰¾ä¸åˆ°åˆ†ç±»æ ‡ç­¾: ${category}`, 'error');
            }
        }
        
        function validateCategoryFilter(expectedCategory) {
            let passed = true;
            
            // æ£€æŸ¥å½“å‰åˆ†ç±»
            if (typeof currentCategory !== 'undefined') {
                if (currentCategory === expectedCategory) {
                    addTestResult(`âœ… å½“å‰åˆ†ç±»æ­£ç¡®: ${currentCategory}`, 'success');
                } else {
                    addTestResult(`âŒ å½“å‰åˆ†ç±»é”™è¯¯: æœŸæœ› ${expectedCategory}, å®é™… ${currentCategory}`, 'error');
                    passed = false;
                }
            } else {
                addTestResult(`âŒ currentCategory å˜é‡æœªå®šä¹‰`, 'error');
                passed = false;
            }
            
            // æ£€æŸ¥ç­›é€‰æ–‡ä»¶æ•°é‡
            if (typeof filteredFiles !== 'undefined' && typeof window.REAL_FILES_DATA !== 'undefined') {
                const expectedCount = expectedCategory === 'all' ? 
                    window.REAL_FILES_DATA.length : 
                    window.REAL_FILES_DATA.filter(file => file.category === expectedCategory).length;
                
                if (filteredFiles.length === expectedCount) {
                    addTestResult(`âœ… ç­›é€‰æ–‡ä»¶æ•°é‡æ­£ç¡®: ${filteredFiles.length}`, 'success');
                } else {
                    addTestResult(`âŒ ç­›é€‰æ–‡ä»¶æ•°é‡é”™è¯¯: æœŸæœ› ${expectedCount}, å®é™… ${filteredFiles.length}`, 'error');
                    passed = false;
                }
            } else {
                addTestResult(`âŒ filteredFiles æˆ– REAL_FILES_DATA æœªå®šä¹‰`, 'error');
                passed = false;
            }
            
            // æ£€æŸ¥æ˜¾ç¤ºçš„æ–‡æ¡£æ•°é‡
            const docItems = document.querySelectorAll('.doc-item');
            if (typeof filteredFiles !== 'undefined') {
                if (docItems.length === filteredFiles.length) {
                    addTestResult(`âœ… æ˜¾ç¤ºæ–‡æ¡£æ•°é‡æ­£ç¡®: ${docItems.length}`, 'success');
                } else {
                    addTestResult(`âŒ æ˜¾ç¤ºæ–‡æ¡£æ•°é‡é”™è¯¯: æœŸæœ› ${filteredFiles.length}, å®é™… ${docItems.length}`, 'error');
                    passed = false;
                }
            }
            
            // æ£€æŸ¥çƒ­é—¨æ¨è
            const hotItems = document.querySelectorAll('.hot-item');
            if (hotItems.length > 0) {
                addTestResult(`âœ… çƒ­é—¨æ¨èå·²æ›´æ–°: ${hotItems.length} é¡¹`, 'success');
            } else {
                addTestResult(`âš ï¸ çƒ­é—¨æ¨èä¸ºç©º`, 'warning');
            }
            
            if (passed) {
                addTestResult(`ğŸ‰ åˆ†ç±» ${expectedCategory} æµ‹è¯•é€šè¿‡`, 'success');
            } else {
                addTestResult(`ğŸ’¥ åˆ†ç±» ${expectedCategory} æµ‹è¯•å¤±è´¥`, 'error');
            }
        }
        
        function testUrlParameter(category) {
            addTestResult(`æµ‹è¯•URLå‚æ•°: category=${category}`, 'info');
            const newUrl = `${window.location.pathname}?category=${category}`;
            window.location.href = newUrl;
        }
        
        function testScrollLoad() {
            addTestResult(`æµ‹è¯•æ»šåŠ¨åŠ è½½`, 'info');
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            window.scrollTo(0, document.body.scrollHeight);
            
            setTimeout(() => {
                const scrollLoading = document.getElementById('scrollLoading');
                if (scrollLoading && scrollLoading.style.display !== 'none') {
                    addTestResult(`âœ… æ»šåŠ¨åŠ è½½è§¦å‘`, 'success');
                } else {
                    addTestResult(`âŒ æ»šåŠ¨åŠ è½½æœªè§¦å‘`, 'error');
                }
            }, 1000);
        }
        
        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
            addTestResult(`æµ‹è¯•ç»“æœå·²æ¸…ç©º`, 'info');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addTestResult('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–æµ‹è¯•', 'info');
            
            setTimeout(() => {
                // æ£€æŸ¥å¿…è¦çš„å˜é‡å’Œå‡½æ•°
                if (typeof window.REAL_FILES_DATA !== 'undefined') {
                    addTestResult(`âœ… REAL_FILES_DATA å·²åŠ è½½: ${window.REAL_FILES_DATA.length} ä¸ªæ–‡ä»¶`, 'success');
                } else {
                    addTestResult(`âŒ REAL_FILES_DATA æœªåŠ è½½`, 'error');
                }
                
                updateStats();
                
                // æ£€æŸ¥URLå‚æ•°
                const urlParams = new URLSearchParams(window.location.search);
                const category = urlParams.get('category');
                if (category) {
                    addTestResult(`æ£€æµ‹åˆ°URLå‚æ•°: category=${category}`, 'info');
                    setTimeout(() => {
                        validateCategoryFilter(category);
                        updateStats();
                    }, 2000);
                }
                
            }, 1000);
            
            // å®šæœŸæ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            setInterval(updateStats, 2000);
        });
    </script>
</body>
</html>
